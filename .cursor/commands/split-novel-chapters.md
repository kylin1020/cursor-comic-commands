# split-novel-chapters

## 📋 任务清单

执行此命令时，请按照以下顺序完成任务，每完成一项就勾选：

### 阶段1：文件读取与分析
- [ ] 接收输入文件：确认用户提供的txt文件路径，读取文件内容
- [ ] 检测文件编码：自动检测文件编码（UTF-8、GBK、GB2312等）
- [ ] 预览文件结构：展示文件的前50-100行，让用户了解文件结构
- [ ] 识别章节模式：分析并识别章节分隔符的模式（第X章、Chapter X、卷X、特殊分隔符等）
- [ ] 展示识别结果：列出识别到的前5-10个章节标题，供用户确认是否正确

### 阶段2：确认拆分策略
- [ ] 确认章节识别：询问用户识别的章节是否正确
- [ ] 调整识别规则：如果不正确，让用户提供正确的章节示例或自定义正则表达式
- [ ] 预估拆分结果：告知用户将生成多少个文件，以及文件命名规则
- [ ] 确认输出目录：确认章节文件的输出位置（默认为`chapters/`目录）

### 阶段3：生成并执行拆分脚本
- [ ] 动态生成脚本：根据识别到的章节格式，生成专门的Python/Bash拆分脚本
- [ ] 创建输出目录：在工作目录下创建`chapters/`目录（如不存在）
- [ ] 执行拆分操作：运行生成的脚本，将txt按章节拆分成独立的.md文件
- [ ] 规范化文件名：确保文件名按照章节顺序命名（如`chapter_001.md`、`chapter_002.md`等）

### 阶段4：验证与收尾
- [ ] 验证输出结果：检查生成的文件数量和内容完整性
- [ ] 展示拆分结果：列出所有生成的章节文件及其标题
- [ ] 生成索引文件：创建`chapters/README.md`包含所有章节的目录索引
- [ ] 清理临时文件：删除过程中产生的脚本和临时文件
- [ ] 提供后续建议：告知用户可以使用`/summarize-novel`命令继续处理

---

## 执行说明

我需要你帮我将一个小说txt文件按章节拆分成独立的.md文件。

**⚠️ 重要说明**：
由于每个小说txt文件的格式可能完全不同，本命令采用"分析-确认-动态生成脚本"的方式，而不是使用预设的固定脚本。这样可以确保拆分的准确性。

### 第一步：提供文件路径并读取内容

请提供小说txt文件的路径（可以是相对路径或绝对路径）。

**示例**：
- `/Users/kylin/projects/novel.txt`
- `./novel.txt`
- `小说名称.txt`

我会先读取文件的前50-100行，展示给你查看文件结构。

### 第二步：分析并识别章节结构

我会尝试识别以下常见的章节分隔模式：

1. **数字章节格式**：
   - `第一章`、`第二章`、`第三章`... （中文数字）
   - `第1章`、`第2章`、`第3章`... （阿拉伯数字）
   - `第001章`、`第002章`... （带零填充）

2. **英文章节格式**：
   - `Chapter 1`、`Chapter 2`...
   - `CHAPTER ONE`、`CHAPTER TWO`...

3. **卷/部分格式**：
   - `第一卷`、`第二卷`...
   - `第一部分`、`第二部分`...

4. **混合格式**：
   - `第一章 标题名称`
   - `Chapter 1: 标题名称`
   - `001 标题名称`

5. **自定义分隔符**：
   - 用户可以指定特定的正则表达式或分隔符

### 第三步：确认分隔规则并查看预览

分析完成后，我会展示：
- 识别到的章节数量
- 前5-10个章节的标题示例
- 使用的分隔规则（正则表达式）

**如果识别准确**：
- 直接确认，进入下一步

**如果识别不准确**，你可以：
1. 提供几个正确的章节标题示例
2. 告诉我章节标题的特征（例如：每章标题都以"=="开头，或者空行后跟数字）
3. 如果熟悉正则表达式，可以直接提供正则模式
4. 描述章节之间的分隔特征

### 第四步：动态生成并执行拆分脚本

根据确认的章节格式，我会：
1. **动态生成专门的Python脚本**（或Bash脚本），针对你的txt文件格式定制
2. 在当前目录创建`chapters/`文件夹（如果不存在）
3. 执行脚本，将每个章节保存为独立的`.md`文件
4. 文件命名格式：`chapter_001.md`、`chapter_002.md`...（三位数字，便于排序）
5. 每个文件顶部包含章节标题作为Markdown一级标题

**脚本特点**：
- 根据实际格式定制，不是通用模板
- 处理文件编码问题（自动检测UTF-8/GBK等）
- 智能处理空行和格式问题
- 执行完成后自动清理

### 第五步：验证并生成索引

拆分完成后，我会：
1. 验证生成的文件完整性
2. 展示所有章节文件列表
3. 自动生成`chapters/README.md`索引文件，包含：
   - 章节总数统计
   - 所有章节的目录列表（带标题和文件链接）
   - 每个章节的字数统计（可选）
4. 清理临时生成的脚本文件

---

## 🔧 动态脚本生成说明

### 核心理念：按需定制，而非通用模板

本命令**不使用预设的固定脚本**，而是根据你的txt文件的实际格式，**动态生成专门的拆分脚本**。

### 为什么要动态生成？

小说txt文件的格式千差万别：
- 有的用"第一章"，有的用"Chapter 1"
- 有的章节标题独占一行，有的前后有装饰符号（如"===第一章==="）
- 有的有空行分隔，有的紧凑排列
- 有的编码是UTF-8，有的是GBK
- 有的有目录索引，有的没有

**固定脚本无法应对所有情况**，只有分析实际文件后生成针对性的脚本，才能保证拆分准确。

### 脚本生成流程

1. **读取分析**：读取txt文件的前100行，分析章节模式
2. **模式识别**：使用正则表达式匹配章节标题
3. **用户确认**：展示识别结果，确保准确
4. **生成脚本**：根据确认的模式，生成定制的Python或Bash脚本
5. **执行拆分**：运行脚本完成拆分
6. **清理环境**：删除临时脚本文件

### 脚本通常包含的功能

根据实际需求，生成的脚本可能包括：

1. **编码检测**：自动检测并正确读取文件编码
2. **章节识别**：使用定制的正则表达式匹配章节
3. **内容提取**：提取每个章节的完整内容
4. **格式清理**：去除多余空行、规范化格式
5. **文件输出**：按顺序生成.md文件
6. **错误处理**：处理边界情况和异常

### 工具选择

- **Python脚本**：适用于复杂格式，需要编码处理、正则匹配等
- **Bash脚本**：适用于简单固定格式，使用`csplit`、`awk`等工具
- **混合方案**：复杂情况下结合多种工具

### 示例：不同格式的处理方式

**格式1：标准章节格式**
```
第一章 开端
正文内容...

第二章 发展
正文内容...
```
→ 使用简单的正则匹配 `^第.+章`

**格式2：装饰性格式**
```
============
  第001章
============
正文内容...
```
→ 需要识别装饰符号，可能需要多行匹配

**格式3：混合格式**
```
Chapter 1: 开端

正文内容...

--- Chapter 2: 发展 ---
正文内容...
```
→ 需要灵活的正则表达式，处理不规则模式

---

## 📌 常见问题处理

### 问题1：章节识别不准确

**原因**：小说格式不规范，章节标记不统一

**解决方案**：
1. 让用户提供几个实际的章节标题示例
2. 根据示例自定义正则表达式
3. 如果章节标记完全不规则，建议用户手动标注后再拆分

### 问题2：文件编码错误

**原因**：txt文件可能使用GBK、GB2312等编码

**解决方案**：
1. 使用`chardet`库自动检测编码
2. 提示用户转换文件编码为UTF-8
3. 脚本自动尝试多种编码方式

### 问题3：章节内容缺失

**原因**：某些章节可能只有标题没有内容

**解决方案**：
1. 生成时保留这些章节文件，标记为"待补充"
2. 在索引文件中特别标注
3. 提醒用户检查原始文件

### 问题4：文件名冲突

**原因**：目标目录已存在同名文件

**解决方案**：
1. 询问用户是否覆盖
2. 提供备份选项
3. 或添加时间戳避免冲突

---

## 输出示例

### 成功输出示例：

```
✅ 章节拆分完成！

📊 统计信息：
- 原始文件：novel.txt (1.2 MB)
- 识别章节：156 章
- 输出目录：chapters/
- 生成文件：156 个 .md 文件
- 索引文件：chapters/README.md

📁 输出文件列表（前10个）：
  chapter_001.md - 第一章 开端
  chapter_002.md - 第二章 相遇
  chapter_003.md - 第三章 转折
  chapter_004.md - 第四章 冲突
  chapter_005.md - 第五章 发展
  ...
  chapter_156.md - 第一百五十六章 终章

💡 下一步建议：
1. 查看 chapters/README.md 浏览完整章节目录
2. 使用 /summarize-novel 命令分析小说内容
3. 使用 /init-comic 命令初始化漫画项目
```

---

## 💡 使用建议

### 工作流程推荐

1. **第一步**：使用本命令（`/split-novel-chapters`）拆分txt文件
2. **第二步**：使用`/summarize-novel`命令分析拆分后的章节，提取角色和场景
3. **第三步**：使用`/init-comic`命令初始化漫画项目
4. **第四步**：使用`/generate-comic-images`命令生成角色和场景图片

### 注意事项

1. **原始文件备份**：拆分前建议备份原始txt文件
2. **章节完整性**：拆分后请检查第一章和最后一章是否完整
3. **特殊字符处理**：文件名中的特殊字符会被替换为下划线
4. **大文件处理**：对于超大文件（>10MB），拆分可能需要几秒到几十秒

### 文件命名规则

- **默认格式**：`chapter_001.md`、`chapter_002.md`...
- **带标题格式**（可选）：`chapter_001_开端.md`、`chapter_002_相遇.md`...
- **保持简洁**：文件名避免过长，标题信息保存在文件内容中

---

## 🛠️ 技术细节

### 支持的文件编码
- UTF-8（推荐）
- UTF-8 with BOM
- GBK / GB2312（简体中文）
- Big5（繁体中文）

### 章节识别正则表达式示例

```python
# 中文数字章节
r'^第[一二三四五六七八九十百千零0-9]+章'

# 阿拉伯数字章节
r'^第\s*\d+\s*章'

# 英文章节
r'^Chapter\s+\d+'

# 卷/部分
r'^第[一二三四五六七八九十百千零0-9]+[卷部]'

# 带标题的章节
r'^第\d+章\s+.+'
```

### 输出文件格式

每个章节文件的格式：

```markdown
# 第一章 开端

（章节内容从这里开始...）
```

---

## 🎯 总结

本命令专门用于预处理小说txt文件，是整个漫画制作流程的第一步。它能够：

✅ 智能识别多种章节格式
✅ 自动拆分并规范化命名
✅ 生成章节索引便于管理
✅ 为后续工作流程做好准备

完成拆分后，你就可以使用其他命令继续处理了！

